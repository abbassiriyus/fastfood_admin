(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[994],{4306:(t,a,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/ofitsant",function(){return s(9077)}])},4486:t=>{"use strict";t.exports="https://ipa.rce.uz"},9077:(t,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>u});var e=s(4848),n=s(6540),o=s(4335),i=s(4486),c=s.n(i),l=s(5093),_=s.n(l),d=s(1300),r=s.n(d);let f=(0,s(4787).io)("".concat(c()));function u(){let[t,a]=(0,n.useState)(0),[s,i]=(0,n.useState)([]),[l,d]=(0,n.useState)([]),[u,h]=(0,n.useState)(!0),[m,x]=(0,n.useState)(null),[b,j]=(0,n.useState)(null),[p,N]=(0,n.useState)(!1),[k,g]=(0,n.useState)(!1);var[v,y]=(0,n.useState)(10);let[S,C]=(0,n.useState)(!1),[T,z]=(0,n.useState)(null),A=t=>{z(t),C(!0)},O=()=>{if(m){h(!0);let t={...m,status:1,user_id:JSON.parse(localStorage.getItem("user")).id};o.A.put("".concat(c(),"/zakaz/").concat(m.id),t).then(t=>{}).catch(t=>{console.error("Xato:",t)}).finally(()=>{E(),h(!1),N(!1),x(null)})}},w=async()=>{if(b){let t={...b,status:2};try{await o.A.put("".concat(c(),"/zakaz/").concat(b.id),t);let a=JSON.parse(localStorage.getItem("user")).id;await o.A.put("".concat(c(),"/users/").concat(a,"/count_seen"),{count_seen:1*(b.price/100*v).toFixed(0)}),E()}catch(t){console.error("Xatolik:",t)}finally{g(!1),j(null)}}};var[q,D]=(0,n.useState)({});(0,n.useEffect)(()=>{localStorage&&D(JSON.parse(localStorage.getItem("user")))},[]),(0,n.useEffect)(()=>(f.on("zakazUpdated",()=>{E()}),o.A.get("".concat(c(),"/protsent")).then(t=>{t.data.length>0&&y(t.data[0].foiz)}),()=>{f.off("zakazUpdated")}),[]);let E=()=>{let t=JSON.parse(localStorage.getItem("user")),a=t?t.id:null;o.A.get("".concat(c(),"/zakaz")).then(t=>{o.A.get("".concat(c(),"/zakaz_products")).then(s=>{o.A.get("".concat(c(),"/products")).then(e=>{o.A.get("".concat(c(),"/users")).then(n=>{for(let t=0;t<s.data.length;t++){for(let a=0;a<e.data.length;a++)s.data[t].product_id==e.data[a].id&&(s.data[t].product_name=e.data[a].name);for(let a=0;a<n.data.length;a++)s.data[t].fastfood_id==n.data[a].id&&(s.data[t].fastfood_name=n.data[a].username)}let o=[],c=[],l=[];t.data.sort((t,a)=>new Date(a.createdAt)-new Date(t.createdAt)).forEach(t=>{t.key=t.id,t.price=0,t.description="<table><thead><tr><th>Fastfood</th><th>Product</th><th>Count</th><th>Price</th><th>Jami</th></tr></thead><tbody>",s.data.forEach(a=>{t.id===a.zakaz_id&&(t.price+=a.price*a.count,t.description+="<tr><td>".concat(a.fastfood_name,"</td><td>").concat(a.product_name,"</td><td>").concat(a.count,"</td><td>").concat(a.price," so'm</td><td>").concat(a.price*a.count," so'm</td></tr>"))}),t.description+="</tbody></table>";let e=t.price*v/100,n=t.price+e;t.description+='\n                        <div style="margin-top: 10px; font-weight: bold;">\n                            Barchasi: '.concat(100*e.toFixed(0)/v," so'm<br>\n                            Xizmat narxi (10%): ").concat(e.toFixed(0)," so'm<br>\n                            Jami summa: ").concat(n.toFixed(0)," so'm\n                        </div>\n                    "),0===t.status?o.push(t):a&&t.user_id===a&&1===t.status?c.push(t):a&&t.user_id===a&&2===t.status&&l.push(t)}),i({statusZeroOrders:o.sort((t,a)=>new Date(a.created_at)-new Date(t.created_at)),statusOneOrders:c.sort((t,a)=>new Date(a.created_at)-new Date(t.created_at)),statusTwoOrders:l.sort((t,a)=>new Date(a.created_at)-new Date(t.created_at))})})})})})};(0,n.useEffect)(()=>{E()},[]);let H=t=>{d(a=>a.includes(t)?a.filter(a=>a!==t):[...a,t])};return(0,e.jsxs)("div",{className:r().ofitsant,children:[(0,e.jsxs)("nav",{className:r().navbar,children:[(0,e.jsx)("div",{className:r().logo,children:"MenuGo"}),(0,e.jsxs)("ul",{className:r().links,children:[(0,e.jsx)("li",{children:(0,e.jsx)("a",{className:"".concat(r().ofitsant__tab," ").concat(0===t?r().ofitsant__tabActive:""),onClick:()=>a(0),children:"Yangilar"})}),(0,e.jsx)("li",{children:(0,e.jsx)("a",{className:"".concat(r().ofitsant__tab," ").concat(1===t?r().ofitsant__tabActive:""),onClick:()=>a(1),children:"Amalda"})}),(0,e.jsx)("li",{children:(0,e.jsx)("a",{className:"".concat(r().ofitsant__tab," ").concat(2===t?r().ofitsant__tabActive:""),onClick:()=>a(2),children:"Tarix"})})]})]}),(0,e.jsx)("h2",{className:r().ofitsant_name,children:q.username||""}),0===t&&(0,e.jsx)("div",{className:r().ofitsant__accordion,children:s.statusZeroOrders&&s.statusZeroOrders.map(t=>(0,e.jsxs)("div",{className:r().ofitsant__accordionItem,children:[(0,e.jsxs)("div",{className:r().ofitsant__accordionHeader,onClick:()=>H(t.key),children:[(0,e.jsxs)("span",{className:r().ofitsant__accordionTitle,children:["No: ",t.id," - stol: ",t.number_stol," - ",_()(t.created_at).format("MM/DD HH:mm")]}),(0,e.jsx)("button",{className:r().ofitsant__button,onClick:a=>{a.stopPropagation(),x(t),N(!0)},children:"Qabul qilish"}),(0,e.jsx)("button",{style:{background:"red"},className:r().ofitsant__button,onClick:a=>{a.stopPropagation(),A(t)},children:"O'chirish"})]}),l.includes(t.key)&&(0,e.jsx)("div",{className:r().ofitsant__accordionContent,dangerouslySetInnerHTML:{__html:t.description}})]},t.key))}),1===t&&(0,e.jsx)("div",{className:r().ofitsant__accordion,children:s.statusOneOrders&&s.statusOneOrders.map(t=>(0,e.jsxs)("div",{className:r().ofitsant__accordionItem,children:[(0,e.jsxs)("div",{className:r().ofitsant__accordionHeader,onClick:()=>H(t.key),children:[(0,e.jsxs)("span",{className:r().ofitsant__accordionTitle,children:["No:",t.id," - stol:",t.number_stol," - ",_()(t.created_at).format("MM/DD HH:mm")]}),(0,e.jsx)("button",{className:r().ofitsant__button,onClick:a=>{a.stopPropagation(),j(t),g(!0)},children:"Tugatish"})]}),l.includes(t.key)&&(0,e.jsx)("div",{className:r().ofitsant__accordionContent,dangerouslySetInnerHTML:{__html:t.description}})]},t.key))}),2===t&&(0,e.jsxs)("table",{className:r().ofitsant__table,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"ID"}),(0,e.jsx)("th",{children:"Stol"}),(0,e.jsx)("th",{children:"Vaqt"}),(0,e.jsx)("th",{children:"Price"})]})}),(0,e.jsx)("tbody",{children:s.statusTwoOrders&&s.statusTwoOrders.filter(t=>_()(t.created_at).isSame(_()(),"day")).map(t=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:t.id}),(0,e.jsx)("td",{children:t.number_stol}),(0,e.jsx)("td",{children:_()(t.created_at).format("MM/DD HH:mm")}),(0,e.jsxs)("td",{children:[t.price," so`m"]})]},t.key))})]}),(0,e.jsxs)("center",{children:[" ",(0,e.jsx)("a",{className:r().chiqsh,href:"/",children:"chiqish"})]}),p&&(0,e.jsxs)("div",{className:r().ofitsant__modal,children:[(0,e.jsx)("h4",{className:r().ofitsant__modalTitle,children:"Yangi buyurtma"}),(0,e.jsx)("p",{className:r().ofitsant__modalText,children:"Siz buyurtmani qabul qilmoqchimisiz?"}),(0,e.jsxs)("div",{className:r().ofitsant__modalActions,children:[(0,e.jsx)("button",{className:r().ofitsant__button,onClick:()=>O(),children:"Qabul qilaman"}),(0,e.jsx)("button",{className:r().ofitsant__buttonCancel,onClick:()=>N(!1),children:"Yopish"})]})]}),k&&(0,e.jsxs)("div",{className:r().ofitsant__modal,children:[(0,e.jsx)("h4",{className:r().ofitsant__modalTitle,children:"Tugatish"}),(0,e.jsx)("p",{className:r().ofitsant__modalText,children:"Buyurtmani tugatganingizni tasdiqlang!"}),(0,e.jsxs)("div",{className:r().ofitsant__modalActions,children:[(0,e.jsx)("button",{className:r().ofitsant__button,onClick:()=>w(),children:"Tasdiqlayman"}),(0,e.jsx)("button",{className:r().ofitsant__buttonCancel,onClick:()=>g(!1),children:"Yopish"})]})]}),S&&(0,e.jsxs)("div",{className:r().ofitsant__modal,children:[(0,e.jsx)("h4",{className:r().ofitsant__modalTitle,children:"Buyurtmani o'chirish"}),(0,e.jsxs)("p",{className:r().ofitsant__modalText,children:["Buyurtma ",(0,e.jsxs)("strong",{children:["No:",null==T?void 0:T.id]})," ni haqiqatdan ham o‘chirmoqchimisiz?"]}),(0,e.jsxs)("div",{className:r().ofitsant__modalActions,children:[(0,e.jsx)("button",{className:r().ofitsant__button,onClick:()=>{T&&o.A.delete("".concat(c(),"/zakaz/").concat(T.id)).then(()=>{E()}).catch(t=>{console.error("O'chirishda xato:",t)}).finally(()=>{C(!1),z(null)})},children:"Ha, o‘chirish"}),(0,e.jsx)("button",{className:r().ofitsant__buttonCancel,onClick:()=>C(!1),children:"Yo‘q, bekor qilish"})]})]})]})}},1300:t=>{t.exports={ofitsant:"ofitsant_ofitsant__VkAmX",ofitsant__tab:"ofitsant_ofitsant__tab__ILjo4",ofitsant__tabActive:"ofitsant_ofitsant__tabActive__VLIoV",ofitsant__accordion:"ofitsant_ofitsant__accordion__fv_cO",ofitsant__accordionItem:"ofitsant_ofitsant__accordionItem__Y_Lry",ofitsant__accordionHeader:"ofitsant_ofitsant__accordionHeader__uU_jT",ofitsant__accordionTitle:"ofitsant_ofitsant__accordionTitle__tLvUU",ofitsant__accordionContent:"ofitsant_ofitsant__accordionContent__QK8tS",ofitsant__modal:"ofitsant_ofitsant__modal__muodL",ofitsant__modalTitle:"ofitsant_ofitsant__modalTitle__AGZRK",ofitsant__modalText:"ofitsant_ofitsant__modalText__3FEMv",ofitsant__modalActions:"ofitsant_ofitsant__modalActions__d5yMq",ofitsant__button:"ofitsant_ofitsant__button__dEuqs",ofitsant__buttonCancel:"ofitsant_ofitsant__buttonCancel__DVx_V",ofitsant__table:"ofitsant_ofitsant__table__G6s0_",ofitsant_name:"ofitsant_ofitsant_name__280WO",navbar:"ofitsant_navbar__P_Eey",logo:"ofitsant_logo__VcXSs",links:"ofitsant_links__cmB6b",link:"ofitsant_link__9mgbz"}}},t=>{var a=a=>t(t.s=a);t.O(0,[197,335,787,636,593,792],()=>a(4306)),_N_E=t.O()}]);